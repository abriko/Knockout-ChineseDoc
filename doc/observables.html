<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Knockout : 监控属性</title> <link href="../css/tripoli.simple.css" type="text/css" rel="stylesheet" /> 
        <link rel="stylesheet" type="text/css" href="../css/styles.css" />
        <link rel="stylesheet" type="text/css" href="../css/smallScreen.css" media="only screen and (max-device-width: 800px)" />
        <!--[if IE]><link rel="stylesheet" type="text/css" href="../css/tripoli.simple.ie.css" /><![endif]-->
        <!--[if lte IE 7]><link rel="stylesheet" type="text/css" href="../css/ie6ie7.css" /><![endif]-->
        <!--[if lte IE 6]><link rel="stylesheet" type="text/css" href="../css/ie6.css" /><![endif]-->
        <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="../js/release.js"></script>
		<!--[if lt IE 7]>
<script defer type="text/javascript" src="../js/ie6pngfix.js"></script>
<![endif]-->
<link type="text/css" rel="stylesheet" href="../js/syntaxhighlighter_3.0.83/styles/shThemeFadeToGrey.css"/>  

<script type="text/javascript">
if (!window.jQuery)document.write('<script type="text/javascript" src="../js/jquery-1.7.2.min.js"><' + '/script>');
    $(function() {
		$('.cn').hover(function(){
				var t = $(this);
				t.next('.en').css('top',t.offset().top + t.height() + 10).css('left',t.offset().left).css('width',t.width()).fadeIn();
			},function(){
				$(this).next('.en').fadeOut();
			});
        // Fancy fonts
        Cufon.replace('.titillium');
        Cufon.replace('.engraved', {
            textShadow: 'rgba(253, 224, 217, 0.45) 1.2px 1px'	
        });
        
        // Syntax highlighting
        $("pre > code").each(function() {
            var codeText = $(this).text();
            $(this).parent().text(codeText).addClass("brush:js");
        });
        SyntaxHighlighter.defaults['toolbar'] = false;
        SyntaxHighlighter.defaults['gutter'] = false;
        SyntaxHighlighter.all();
        
        // Highlight current top menu item
        var desiredMenuItem = '' || 'documentation';
        $(".main-menu a[rel=" + desiredMenuItem + "]").addClass("active");
        
        // Highlight current left-hand-nav menu item
        var urlFilename = location.href.match(/\/([^\/]+)$/);
        if (urlFilename) {
            $(".leftColContents li:has(a[href$='" + urlFilename[1] + "'])").addClass("active");
        }
    });
</script> 
    </head>
    <body>
        <div id="wrapper">
            <div class="vspace"></div>
            <div class="main-menu">
    <ul>
        <li><a rel="home" href="../index.html">主页</a></li>
        <li><a rel="installation" href="./installation.html">下载 / 安装</a></li>
        <li><a rel="examples" href="../examples/">在线例子</a></li>
        <li><a rel="documentation" href="./introduction.html">文档</a></li>
        <li><a href="http://groups.google.com/group/knockoutjs">论坛</a></li>
        <li><a href="http://github.com/SteveSanderson/knockout">源码</a></li>
    </ul>
</div>        	
<div class="clear"></div>
            <div class="vspace"></div>
            <div>	
	<div class="leftCol">		
		<div class="leftColBackground">&nbsp;</div>
		<div class="leftColContents">
			<h1>入门</h1>

<ol>
    <li><a href="introduction.html">KO工作原理及带来的好处</a></li>
    <li><a href="installation.html">下载安装</a></li>
</ol>

<h1>监控属性</h1>

<ol>
    <li><a href="observables.html">创建带有监控属性的 <em>view model</em></a></li>
    <li><a href="computedObservables.html">使用<em>自动计算属性(Computed Observables)</em></a></li>
    <li><a href="observableArrays.html">使用<em>监控数组(Observable Arrays)</em></a></li>	
</ol>

<h1>使用内置绑定</h1>

<h2>控制文本和外观</h2>
<ol>
<li><a href="visible-binding.html"><code>visible</code> 绑定</a><a class="en" href="visible-binding.html">The <code>visible</code> binding</a></li>
<li><a href="text-binding.html"><code>text</code> 绑定</a></li>
<li><a href="html-binding.html"><code>html</code> 绑定</a></li>
<li><a href="css-binding.html"><code>css</code> 绑定</a></li>
<li><a href="style-binding.html"><code>style</code> 绑定</a></li>
<li><a href="attr-binding.html"><code>attr</code> 绑定</a></li>
</ol>

<h2>绑定逻辑控制</h2>
<ol>
<li><a href="foreach-binding.html"><code>foreach</code> 绑定</a></li>
<li><a href="if-binding.html"><code>if</code> 绑定</a></li>
<li><a href="ifnot-binding.html"><code>ifnot</code> 绑定</a></li>
<li><a href="with-binding.html"><code>with</code> 绑定</a></li>
</ol>

<h2>处理表单属性</h2>
<ol>
    <li><a href="click-binding.html"><code>click</code> 绑定</a></li>
    <li><a href="event-binding.html"><code>event</code> 绑定</a></li>
    <li><a href="submit-binding.html"><code>submit</code> 绑定</a></li>
    <li><a href="enable-binding.html"><code>enable</code> 绑定</a></li>
    <li><a href="disable-binding.html"><code>disable</code> 绑定</a></li>
    <li><a href="value-binding.html"><code>value</code> 绑定</a></li>
    <li><a href="hasfocus-binding.html"><code>hasfocus</code> 绑定</a></li>
    <li><a href="checked-binding.html"><code>checked</code> 绑定</a></li>
    <li><a href="options-binding.html"><code>options</code> 绑定</a></li>
    <li><a href="selectedOptions-binding.html"><code>selectedOptions</code> 绑定</a></li>    
    <li><a href="uniqueName-binding.html"><code>uniqueName</code> 绑定</a></li>		
</ol>

<h2>解析模板</h2>
<ol>
    <li><a href="template-binding.html"><code>template</code> 绑定</a></li>
</ol>

<h2>高级应用</h2>
<ol>
    <li><a href="custom-bindings.html">自定义绑定</a></li>
    <li><a href="json-data.html">读取和保存JSON数据</a></li>
    <li><a href="extenders.html">扩展observables监控</a></li>
    <li><a href="throttle-extender.html">The <code>throttle</code> extender</a></li>
    <li><a href="unobtrusive-event-handling.html">非显式事件绑定</a></li>
    <li><a href="fn.html"><code>fn</code> 自定义函数</a></li>
</ol>

<h2>插件</h2>
<ol>
    <li><a href="plugins-mapping.html"><code>mapping</code> 插件</a></li>
</ol>

<h1>更多信息</h1>
<ol>
    <li><a href="browser-support.html">浏览支持</a></li>
    <li><a href="http://groups.google.com/group/knockoutjs">取得帮助</a></li>
    <li><a href="links.html">在线例子</a></li>
</ol>
		</div>		
	</div>
	<div class="rightCol">
		<div class="documentation sticker">
		    <div class="content">
		    	<h1>监控属性</h1>	
                <p class="cn">Knockout是在下面三个核心功能是建立起来的：</p>
		    	<p class="en">Knockout is built around three core features:</p>

<ol>
<li class="cn">监控属性（Observables）和依赖跟踪（Dependency tracking）</li>
<li class="en">Observables and dependency tracking</li>

<li class="cn">声明式绑定（Declarative bindings）</li>
<li class="en">Declarative bindings</li>

<li class="cn">模板（Templating）</li>
<li class="en">Templating</li>
</ol>

<p class="cn">这一节，你讲学到3个功能中的第一个。 在这之前， 我们来解释一下MVVM模式和<em>view model</em>的概念。</p>
<p class="en">On this page, you&#8217;ll learn about the first of these three. But before that, let me explain the MVVM pattern and the concept of a <em>view model</em>.</p>

<h1 id='mvvm_and_view_models'>MVVM and View Models</h1>

<p class="cn"><em>Model-View-View Model (MVVM)</em>  是一种创建用户界面的设计模式。 描述的是如何将复杂的UI用户界面分成3个部分：</p>
<p class="en"><em>Model-View-View Model (MVVM)</em> is a design pattern for building user interfaces. It describes how you can keep a potentially sophisticated UI simple by splitting it into three parts:</p>

<ul>
<li>
<p class="cn"><em>model</em>:你程序里存储的数据。这个数据包括对象和业务操作（例如：银子账户可以完成转账功能）， 并且独立于任何UI。使用KO的时候，通常说是向服务器调用Ajax读写这个存储的模型数据。</p>
<p class="en">A <em>model</em>: your application&#8217;s stored data. This data represents objects and operations in your business domain (e.g., bank accounts that can perform money transfers) and is independent of any UI. When using KO, you will usually make Ajax calls to some server-side code to read and write this stored model data.</p>
</li>

<li>
<p class="cn"><em>view model</em>: 在UI上，纯code描述的数据以及操作。例如，如果你实现列表编辑，你的view model应该是一个包含列表项items的对象和暴露的add/remove列表项（item）的操作方法。</p>
<p class="en">A <em>view model</em>: a pure-code representation of the data and operations on a UI. For example, if you&#8217;re implementing a list editor, your view model would be an object holding a list of items, and exposing methods to add and remove items.</p>

<p class="cn">注意这不是UI本身：它不包含任何按钮的概念或者显示风格。它也不是持续数据模型 – 包含用户正在使用的未保存数据。使用KO的时候，你的view models是不包含任何HTML知识的纯JavaScript 对象。保持view model抽象可以保持简单，以便你能管理更复杂的行为。</p>
<p class="en">Note that this is not the UI itself: it doesn&#8217;t have any concept of buttons or display styles. It&#8217;s not the persisted data model either - it holds the unsaved data the user is working with. When using KO, your view models are pure JavaScript objects that hold no knowledge of HTML. Keeping the view model abstract in this way lets it stay simple, so you can manage more sophisticated behaviors without getting lost.</p>
</li>

<li>
<p class="cn"><em>view</em>: 一个可见的，交互式的，表示view model状态的UI。 从view model显示数据，发送命令到view model（例如：当用户click按钮的时候） ，任何view model状态改变的时候更新。</p>
<p class="en">A <em>view</em>: a visible, interactive UI representing the state of the view model. It displays information from the view model, sends commands to the view model (e.g., when the user clicks buttons), and updates whenever the state of the view model changes.</p>

<p class="cn">使用KO的时候，你的view就是你带有绑定信息的HTML文档，这些声明式的绑定管理到你的view model上。或者你可以使用模板从你的view model获取数据生成HTML。</p>
<p class="en">When using KO, your view is simply your HTML document with declarative bindings to link it to the view model. Alternatively, you can use templates that generate HTML using data from your view model.</p>
</li>
</ul>

<p>创建一个view model，只需要声明任意的JavaScript object。例如：</p>

<pre><code>var myViewModel = {
    personName: &#39;Bob&#39;,
    personAge: 123
};</code></pre>

<p class="cn">你可以为view model创建一个声明式绑定的简单 <em>view</em> 。例如：下面的代码显示 <code>personName</code> 值：</p>
<p class="en">You can then create a very simple <em>view</em> of this view model using a declarative binding. For example, the following markup displays the <code>personName</code> value:</p>

<pre><code>The name is &lt;span data-bind=&quot;text: personName&quot;&gt;&lt;/span&gt;</code></pre>

<h2 id='activating_knockout'>激活 Knockout</h2>

<p class="cn"><code>data-bind</code> 属性尽快好用但它不是HTML的原生属性（它严格遵从HTML5语法， 虽然HTML4验证器提示有不可识别的属性但依然可用）。由于浏览器不识别它是什么意思，所以你需要激活Knockout 来让他起作用。</p>
<p class="en">The <code>data-bind</code> attribute isn&#8217;t native to HTML, though it is perfectly OK (it&#8217;s strictly compliant in HTML 5, and causes no problems with HTML 4 even though a validator will point out that it&#8217;s an unrecognized attribute). But since the browser doesn&#8217;t know what it means, you need to activate Knockout to make it take effect.</p>

<p class="cn">激活Knockout，需要添加如下的 <code>&lt;script&gt;</code> 代码块：</p>
<p class="en">To activate Knockout, add the following line to a <code>&lt;script&gt;</code> block:</p>

<pre><code>ko.applyBindings(myViewModel);</code></pre>

<p class="cn">你可以将这个代码块放在HTML底部，或者放在 <a href='http://api.jquery.com/jQuery/#jQuery3'>jQuery&#8217;s <code>$</code> 函数或者ready 函数里</a>。</p>
<p class="en">You can either put the script block at the bottom of your HTML document, or you can put it at the top and wrap the contents in a DOM-ready handler such as <a href='http://api.jquery.com/jQuery/#jQuery3'>jQuery&#8217;s <code>$</code> function</a>.</p>

<p class="cn">然后放在页面上面, 最终生成结果就是如下的HTML代码：:</p>
<p class="en">That does it! Now, your view will display as if you&#8217;d written the following HTML:</p>

<pre><code>The name is &lt;span&gt;Bob&lt;/span&gt;</code></pre>

<p class="cn">你可能奇怪 <code>ko.applyBindings</code> 使用的是什么样的参数,</p>
<p class="en">In case you&#8217;re wondering what the parameters to <code>ko.applyBindings</code> do,</p>

<ul>
<li>
<p class="cn">第一个参数是你想用于声明式绑定</p>
<p class="en">The first parameter says what view model object you want to use with the declarative bindings it activates</p>
</li>

<li>
<p class="cn">第二个参数（可选），可以声明成使用data-bind的HTML元素或者容器。例如， <code>ko.applyBindings(myViewModel, document.getElementById(&#39;someElementId&#39;))</code>。它的现在是只有作为 <code>someElementId</code> 的元素和子元素才能激活KO功能。 好处是你可以在同一个页面声明多个view model，用来区分区域。</p>
<p class="en">Optionally, you can pass a second parameter to define which part of the document you want to search for <code>data-bind</code> attributes. For example, <code>ko.applyBindings(myViewModel, document.getElementById(&#39;someElementId&#39;))</code>. This restricts the activation to the element with ID <code>someElementId</code> and its descendants, which is useful if you want to have multiple view models and associate each with a different region of the page.</p>
</li>
</ul>

<h1 id='observables'>Observables</h1>

<p class="cn">现在已经知道如何创建一个简单的view model并且通过binding显示它的属性了。但是KO一个重要的功能是当你的view model改变的时候能自动更新你的界面。当你的view model部分改变的时候KO是如何知道的呢？答案是：你需要将你的model属性声明成 <em>observables</em>的, 因为它是非常特殊的JavaScript objects，能够通知订阅者它的改变以及自动探测到相关的依赖。</p>
<p class="en">OK, you&#8217;ve seen how to create a basic view model and how to display one of its properties using a binding. But one of the key benefits of KO is that it updates your UI automatically when the view model changes. How can KO know when parts of your view model change? Answer: you need to declare your model properties as <em>observables</em>, because these are special JavaScript objects that can notify subscribers about changes, and can automatically detect dependencies.</p>

<p class="cn">例如：将上述例子的view model改成如下代码：</p>
<p class="en">For example, rewrite the preceding view model object as follows:</p>

<pre><code>var myViewModel = {
    personName: ko.observable(&#39;Bob&#39;),
    personAge: ko.observable(123)
};</code></pre>

<p class="cn">你根本不需要修改view – 所有的 <code>data-bind</code> 语法依然工作，不同的是他能监控到变化，当值改变时，view会自动更新。</p>
<p class="cn">You don&#8217;t have to change the view at all - the same <code>data-bind</code> syntax will keep working. The difference is that it&#8217;s now capable of detecting changes, and when it does, it will update the view automatically.</p>

<h2 id='reading_and_writing_observables'>监控属性（observables）的读和写</h2>

<p class="cn">不是所有的浏览器都支持JavaScript的 getters and setters (比如IE),，所以为了兼容性，使用 <code>ko.observable</code> 监控的对象都是真实的 <em>functions</em>函数。</p>
<p class="en">Not all browsers support JavaScript getters and setters (* cough * IE * cough *), so for compatibility, <code>ko.observable</code> objects are actually <em>functions</em>.</p>

<ul>
<li>
<p class="cn"><strong>读取</strong>监控属性（observable）的值，只需要直接调用监控属性（observable）（不需要参数），例如 <code>myViewModel.personName()</code> 将返回 <code>&#39;Bob&#39;</code>,<code>myViewModel.personAge()</code> 将返回 <code>123</code>.</p>
<p class="en">To <strong>read</strong> the observable&#8217;s current value, just call the observable with no parameters. In this example, <code>myViewModel.personName()</code> will return <code>&#39;Bob&#39;</code>, and <code>myViewModel.personAge()</code> will return <code>123</code>.</p>
</li>

<li>
<p class="cn"><strong>写</strong>一个新值到监控属性（observable）上，调用这个observable属性并当新值作为参数。例如：调用 <code>myViewModel.personName(&#39;Mary&#39;)</code> 将更新name值为 <code>&#39;Mary&#39;</code>。</p>
<p class="en">To <strong>write</strong> a new value to the observable, call the observable and pass the new value as a parameter. For example, calling <code>myViewModel.personName(&#39;Mary&#39;)</code> will change the name value to <code>&#39;Mary&#39;</code>.</p>
</li>

<li>
<p class="cn">给一个model对象的<strong>多个属性写入新值</strong>，你可以使用<em>链式语法</em>。例如： <code>myViewModel.personName(&#39;Mary&#39;).personAge(50)</code> 将会将name更新为 <code>&#39;Mary&#39;</code> <em>并且</em>将age更新为 <code>50</code>.</p>
<p class="en">To write values to <strong>multiple observable properties</strong> on a model object, you can use <em>chaining syntax</em>. For example, <code>myViewModel.personName(&#39;Mary&#39;).personAge(50)</code> will change the name value to <code>&#39;Mary&#39;</code> <em>and</em> the age value to <code>50</code>.</p>
</li>
</ul>

<p class="cn">监控属性（observables）的特征就是监控（observed），例如其它代码可以说我需要得到对象变化的通知，所以KO内部有很多内置的绑定语法。所以如果你的代码写成 <code>data-bind=&quot;text: personName&quot;</code> ， <code>text</code> 绑定注册到自身，一旦 <code>personName</code> 的值改变，它就能得到通知。</p>
<p class="en">The whole point of observables is that they can be observed, i.e., other code can say that it wants to be notified of changes. That&#8217;s what many of KO&#8217;s built-in bindings do internally. So, when you wrote <code>data-bind=&quot;text: personName&quot;</code>, the <code>text</code> binding registered itself to be notified when <code>personName</code> changes (assuming it&#8217;s an observable value, which it is now).</p>

<p class="cn">当然调用 <code>myViewModel.personName(&#39;Mary&#39;)</code> 改变name的值， <code>text</code> 绑定将自动更新这个新值到相应的DOM元素上。这就是如何将view model的改变传播到view上的。</p>
<p class="en">When you change the name value to <code>&#39;Mary&#39;</code> by calling <code>myViewModel.personName(&#39;Mary&#39;)</code>, the <code>text</code> binding will automatically update the text contents of the associated DOM element. That&#8217;s how changes to the view model automatically propagate to the view.</p>

<h2 id='explicitly_subscribing_to_observables'>监控属性（Observables）的显式订阅</h2>

<p><em>通常情况下，你不用手工订阅，所以新手可以忽略此小节。</em></p>

<p class="cn">高级用户，如果你要注册自己的订阅到监控属性（observables），你可以调用它的 <code>subscribe</code>  函数。例如：</p>
<p class="en">For advanced users, if you want to register your own subscriptions to be notified of changes to observables, you can call their <code>subscribe</code> function. For example,</p>

<pre><code>myViewModel.personName.subscribe(function(newValue) {
	alert(&quot;The person&#39;s new name is &quot; + newValue);
});</code></pre>

<p class="cn">这个 <code>subscribe</code> 函数在内部很多地方都用到的。你也可以终止自己的订阅：首先得到你的订阅，然后调用这个对象的 <code>dispose</code> 函数，例如：</p>
<p class="en">The <code>subscribe</code> function is how many parts of KO work internally. You can also terminate a subscription if you wish: first capture it as a variable, then you can call its <code>dispose</code> function, e.g.:</p>

<pre><code>var subscription = myViewModel.personName.subscribe(function(newValue) { /* do stuff */ });
// ...then later...
subscription.dispose(); // I no longer want notifications</code></pre>

<p class="cn">大多数情况下，你不需要做这些，因为内置的绑定和模板系统已经帮你做好很多事情了，可以直接使用它们。</p>
<p class="en">Most of the time you don&#8217;t need to do this, because the built-in bindings and templating system take care of managing subscriptions.</p>    
		    </div>
		    
		    <div class="clear"></div>
		</div>
	</div>	
</div>
            <div class="clear"></div>
            <div class="main-menu">
    <ul>
        <li><a rel="home" href="../index.html">主页</a></li>
        <li><a rel="installation" href="./installation.html">下载 / 安装</a></li>
        <li><a rel="examples" href="../examples/">在线例子</a></li>
        <li><a rel="documentation" href="./introduction.html">文档</a></li>
        <li><a href="http://groups.google.com/group/knockoutjs">论坛</a></li>
        <li><a href="http://github.com/SteveSanderson/knockout">源码</a></li>
    </ul>
</div>        	
<div class="clear"></div>
        </div>
        
    <div id="page-footer">(c) knockoutjs.com</div>

    </body>
</html>